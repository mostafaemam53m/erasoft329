أولًا Eloquent Query Scopes

تعريف Query Scopes

Query Scopes هي طريقة لإعادة استخدام شروط معينة ضمن استعلامات قواعد البيانات في نماذج Eloquent بحيث يتم كتابة فلتر معين مرة واحدة ثم إعادة استخدامه في أي استعلام دون الحاجة إلى تكرار الشروط مما يجعل الكود أكثر تنظيمًا وأسهل في الصيانة

أنواع Query Scopes

تنقسم Scopes إلى نوعين رئيسيين

واحد Local Scope وهو الفلتر المحلي ويُعرف داخل نموذج Eloquent ويُستخدم عند الحاجة إليه من خلال استدعائه مع الاستعلام

اثنان Global Scope وهو نطاق يتم تطبيقه تلقائيًا على كل استعلام يخص النموذج ويُستخدم عادةً لضمان شروط ثابتة مثل إحضار السجلات النشطة فقط

مميزات استخدام Query Scopes

يساعد استخدام Query Scopes في تقليل التكرار في الكود وتحسين تنظيمه كما يجعل الاستعلامات أكثر وضوحًا وسهولة في القراءة ويوفر الوقت عند تكرار استخدام شروط معينة

تطبيقات عملية على Query Scopes

يستخدم المطورون Scopes في حالات متعددة مثل تصفية المستخدمين النشطين أو تصنيف المنتجات حسب النوع أو تحديد الطلبات بحسب الحالة وهي طريقة فعالة لإبقاء منطق التصفية مركزيًا داخل النموذج بدلًا من توزيعه في جميع أنحاء الكود

ثانيًا Database Transactions

تعريف المعاملات Transactions

Database Transactions هي تقنية تتيح تنفيذ مجموعة من العمليات على قاعدة البيانات كوحدة واحدة بحيث إذا فشلت أي عملية من هذه العمليات يتم التراجع عن جميع العمليات الأخرى تلقائيًا مما يضمن عدم إدخال بيانات غير مكتملة أو غير متناسقة

أهمية استخدام Transactions

تُستخدم المعاملات في حالات تتطلب تنفيذ أكثر من عملية متتالية تعتمد على بعضها البعض مثل عمليات الدفع وإنشاء الطلبات وتحديث المخزون في حال حدوث خطأ في أي خطوة فإن التراجع عن كل العمليات يضمن أن تظل قاعدة البيانات في حالة صحيحة

أسلوب التنفيذ

يمكن تنفيذ المعاملات في Laravel باستخدام طريقتين الطريقة الأولى هي باستخدام أسلوب يدوي من خلال بدء المعاملة يدويًا ثم محاولة تنفيذ العمليات وعند النجاح يتم حفظ التغييرات وإن فشلت أي عملية يتم التراجع عنها الطريقة الثانية هي الأسلوب المبسط باستخدام دالة transaction التي تنفذ المعاملة وتقوم تلقائيًا بعملية الحفظ أو التراجع بناءً على نجاح العمليات بداخلها

مميزات استخدام Transactions

تساعد المعاملات في حماية قاعدة البيانات من الإدخال الخاطئ أو الجزئي وتوفر مستوى عاليًا من السلامة خاصةً في العمليات المالية أو الحساسة كما تضمن التناسق التام في البيانات

حالات عملية لاستخدام Transactions

من أبرز الحالات استخدام المعاملات عند إنشاء حسابات جديدة وربطها بأدوار أو عند تنفيذ عمليات شراء يتم فيها تحديث المخزون وإنشاء فاتورة وتسجيل عملية الدفع كلها في نفس الوقت إذا فشل أحدها يتم التراجع عن الكل

مقارنة بين Query Scopes و Transactions

على الرغم من اختلاف طبيعة كل أداة إلا أن كلاهما يخدم هدفًا واحدًا وهو تحسين جودة الكود وضمان تنظيمه حيث أن Query Scopes تهتم بتنظيم الاستعلامات وجعلها أكثر مرونة بينما تهتم Transactions بضمان تنفيذ البيانات بشكل آمن وكامل دون أخطاء
